<?php
/**
 * Template name: Testimonials
 */
get_header();
?>

<main>

	<section class="testimonials-top">
		<div class="container">
			<h2 class="h2"><?php the_field('page_title'); ?></h2>
		</div>   
	</section> 
	
	<?php 
	$testimonials = get_field('testimonials');
	$testimonials_count = count($testimonials);
	$slides = $testimonials;
	$sum = 0;
	$villas = [];
	foreach($slides as $key=>$slide) {
		$sum = $sum + $slide['rating'];
		$villas[] = $slide['selected_villa'][0];
		if($slide["use_for_slider"] != 1) {
			unset($slides[$key]);
		}
	}
	$average_rating = round($sum / $testimonials_count, 1);
	?>
	
	<?php if($slides) : ?>
		<section class="testimonials-slide">
			<div class="container">
				<div class="testimonials-slider">
					<?php foreach($slides as $slide) :  ?>
						<div class="testimonials-slide__item">
							<div class="left">
								<div class="star rating_<?php echo $slide["rating"]; ?>">
									<svg width="107" height="16" viewBox="0 0 107 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.2357 5.36836C13.5902 5.36836 11.9447 5.38625 10.2993 5.40413C9.67327 3.72288 9.04727 2.02374 8.45704 0.324599C8.34973 0.00265624 7.81316 -0.158315 7.65218 0.217284C6.90099 1.9522 6.14979 3.68711 5.45224 5.45779C3.91408 5.49356 2.37591 5.52933 0.855622 5.5651C0.40848 5.58299 0.0865374 6.1911 0.462137 6.51304C0.998708 6.96019 1.51739 7.42521 2.03608 7.90813C2.48322 8.3195 2.91248 8.74876 3.34173 9.1959C3.5027 9.37475 3.73522 9.5715 3.86042 9.78613C4.02139 10.0723 3.84253 10.3227 3.73522 10.591C3.1271 12.1291 2.57265 13.7031 2.03608 15.277C1.87511 15.7242 2.46533 16.1892 2.85882 15.9209C4.03927 15.1339 5.23762 14.347 6.43596 13.5958C6.79367 13.3811 7.15139 13.1486 7.5091 12.934C7.84893 12.7373 7.90258 12.7909 8.22453 12.9877C8.49281 13.1486 8.7611 13.3275 9.0115 13.5063C10.1383 14.2933 11.1757 15.1697 12.3561 15.8851C12.7138 16.0998 13.1431 15.7421 13.0358 15.3665C12.7317 14.1681 12.4455 12.9877 12.1951 11.7714C12.0699 11.1633 11.8732 10.5016 11.8374 9.89344C11.8195 9.33898 12.3203 9.08858 12.6959 8.76664C13.6618 7.92601 14.6097 7.0675 15.5577 6.1911C15.8796 5.88705 15.6292 5.36836 15.2357 5.36836Z" fill="#26848B"/><path d="M37.9037 5.36836C36.2582 5.36836 34.6127 5.38625 32.9672 5.40413C32.3412 3.72288 31.7152 2.02374 31.125 0.324599C31.0177 0.00265624 30.4811 -0.158315 30.3202 0.217284C29.569 1.9522 28.8178 3.68711 28.1202 5.45779C26.582 5.49356 25.0439 5.52933 23.5236 5.5651C23.0764 5.58299 22.7545 6.1911 23.1301 6.51304C23.6667 6.96019 24.1854 7.42521 24.704 7.90813C25.1512 8.3195 25.5804 8.74876 26.0097 9.1959C26.1707 9.37475 26.4032 9.5715 26.5284 9.78613C26.6894 10.0723 26.5105 10.3227 26.4032 10.591C25.7951 12.1291 25.2406 13.7031 24.704 15.277C24.5431 15.7242 25.1333 16.1892 25.5268 15.9209C26.7072 15.1339 27.9056 14.347 29.1039 13.5958C29.4616 13.3811 29.8194 13.1486 30.1771 12.934C30.5169 12.7373 30.5706 12.7909 30.8925 12.9877C31.1608 13.1486 31.4291 13.3275 31.6795 13.5063C32.8063 14.2933 33.8436 15.1697 35.0241 15.8851C35.3818 16.0998 35.8111 15.7421 35.7037 15.3665C35.3997 14.1681 35.1135 12.9877 34.8631 11.7714C34.7379 11.1633 34.5412 10.5016 34.5054 9.89344C34.4875 9.33898 34.9883 9.08858 35.3639 8.76664C36.3297 7.92601 37.2777 7.0675 38.2256 6.1911C38.5476 5.88705 38.2972 5.36836 37.9037 5.36836Z" fill="#26848B"/><path d="M60.5677 5.36836C58.9223 5.36836 57.2768 5.38625 55.6313 5.40413C55.0053 3.72288 54.3793 2.02374 53.7891 0.324599C53.6818 0.00265624 53.1452 -0.158315 52.9842 0.217284C52.233 1.9522 51.4818 3.68711 50.7843 5.45779C49.2461 5.49356 47.7079 5.52933 46.1877 5.5651C45.7405 5.58299 45.4186 6.1911 45.7942 6.51304C46.3307 6.96019 46.8494 7.42521 47.3681 7.90813C47.8153 8.3195 48.2445 8.74876 48.6738 9.1959C48.8347 9.37475 49.0672 9.5715 49.1924 9.78613C49.3534 10.0723 49.1746 10.3227 49.0672 10.591C48.4591 12.1291 47.9047 13.7031 47.3681 15.277C47.2071 15.7242 47.7974 16.1892 48.1909 15.9209C49.3713 15.1339 50.5696 14.347 51.768 13.5958C52.1257 13.3811 52.4834 13.1486 52.8411 12.934C53.181 12.7373 53.2346 12.7909 53.5566 12.9877C53.8248 13.1486 54.0931 13.3275 54.3435 13.5063C55.4703 14.2933 56.5077 15.1697 57.6882 15.8851C58.0459 16.0998 58.4751 15.7421 58.3678 15.3665C58.0638 14.1681 57.7776 12.9877 57.5272 11.7714C57.402 11.1633 57.2052 10.5016 57.1695 9.89344C57.1516 9.33898 57.6524 9.08858 58.028 8.76664C58.9938 7.92601 59.9417 7.0675 60.8897 6.1911C61.2116 5.88705 60.9612 5.36836 60.5677 5.36836Z" fill="#26848B"/><path d="M83.2357 5.36836C81.5902 5.36836 79.9447 5.38625 78.2993 5.40413C77.6733 3.72288 77.0473 2.02374 76.457 0.324599C76.3497 0.00265624 75.8132 -0.158315 75.6522 0.217284C74.901 1.9522 74.1498 3.68711 73.4522 5.45779C71.9141 5.49356 70.3759 5.52933 68.8556 5.5651C68.4085 5.58299 68.0865 6.1911 68.4621 6.51304C68.9987 6.96019 69.5174 7.42521 70.0361 7.90813C70.4832 8.3195 70.9125 8.74876 71.3417 9.1959C71.5027 9.37475 71.7352 9.5715 71.8604 9.78613C72.0214 10.0723 71.8425 10.3227 71.7352 10.591C71.1271 12.1291 70.5726 13.7031 70.0361 15.277C69.8751 15.7242 70.4653 16.1892 70.8588 15.9209C72.0393 15.1339 73.2376 14.347 74.436 13.5958C74.7937 13.3811 75.1514 13.1486 75.5091 12.934C75.8489 12.7373 75.9026 12.7909 76.2245 12.9877C76.4928 13.1486 76.7611 13.3275 77.0115 13.5063C78.1383 14.2933 79.1757 15.1697 80.3561 15.8851C80.7138 16.0998 81.1431 15.7421 81.0358 15.3665C80.7317 14.1681 80.4455 12.9877 80.1951 11.7714C80.0699 11.1633 79.8732 10.5016 79.8374 9.89344C79.8195 9.33898 80.3203 9.08858 80.6959 8.76664C81.6618 7.92601 82.6097 7.0675 83.5577 6.1911C83.8796 5.88705 83.6292 5.36836 83.2357 5.36836Z" fill="#26848B"/><path d="M105.904 5.36836C104.258 5.36836 102.613 5.38625 100.967 5.40413C100.341 3.72288 99.7152 2.02374 99.125 0.324599C99.0177 0.00265624 98.4811 -0.158315 98.3202 0.217284C97.569 1.9522 96.8178 3.68711 96.1202 5.45779C94.582 5.49356 93.0439 5.52933 91.5236 5.5651C91.0764 5.58299 90.7545 6.1911 91.1301 6.51304C91.6667 6.96019 92.1854 7.42521 92.704 7.90813C93.1512 8.3195 93.5804 8.74876 94.0097 9.1959C94.1707 9.37475 94.4032 9.5715 94.5284 9.78613C94.6894 10.0723 94.5105 10.3227 94.4032 10.591C93.7951 12.1291 93.2406 13.7031 92.704 15.277C92.5431 15.7242 93.1333 16.1892 93.5268 15.9209C94.7072 15.1339 95.9056 14.347 97.1039 13.5958C97.4616 13.3811 97.8194 13.1486 98.1771 12.934C98.5169 12.7373 98.5706 12.7909 98.8925 12.9877C99.1608 13.1486 99.4291 13.3275 99.6795 13.5063C100.806 14.2933 101.844 15.1697 103.024 15.8851C103.382 16.0998 103.811 15.7421 103.704 15.3665C103.4 14.1681 103.114 12.9877 102.863 11.7714C102.738 11.1633 102.541 10.5016 102.505 9.89344C102.488 9.33898 102.988 9.08858 103.364 8.76664C104.33 7.92601 105.278 7.0675 106.226 6.1911C106.548 5.88705 106.297 5.36836 105.904 5.36836Z" fill="#26848B"/></svg>
								</div>
								<div class="desc">
									<?php echo $slide["review_text"]; ?>
								</div>
								<div class="bottom">
									<div class="subtitle"><?php echo $slide["review_author"]; ?></div>
									<div class="time"><?php echo $slide["review_date"]; ?></div>
								</div>
							</div>
							<?php $villa = get_post($slide["selected_villa"][0]); ?>
							<div class="right">
								<div class="cart">
									<div class="img">
										<?php echo get_the_post_thumbnail($villa->ID, 'medium'); ?>
									</div>
									<div class="loc">
										<div class="ico">
											<svg width="9" height="13" viewBox="0 0 9 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.40525 0C1.97618 0 0 1.97618 0 4.40523C0 7.41975 3.94227 11.8452 4.11011 12.0322C4.26777 12.2078 4.54302 12.2074 4.70039 12.0322C4.86824 11.8452 8.8105 7.41975 8.8105 4.40523C8.81046 1.97618 6.8343 0 4.40525 0ZM4.40525 6.62162C3.18313 6.62162 2.18888 5.62735 2.18888 4.40523C2.18888 3.1831 3.18315 2.18886 4.40525 2.18886C5.62735 2.18886 6.6216 3.18313 6.6216 4.40525C6.6216 5.62738 5.62735 6.62162 4.40525 6.62162Z" fill="#A3A5A7"/></svg>
										</div>
										<?php 
										$location = wp_get_post_terms($villa->ID, 'areas');
										echo get_full_area($location[0], '', 'text');
										?>
									</div>

									<div class="txt">
										<h4 class="h4"><?php echo strtok(get_the_title($villa->ID), ','); ?></h4>
										<a href="<?php echo get_the_permalink($villa->ID); ?>" class="link">
											DISCOVER
										</a>
									</div>
									<?php 
									$villa_info  = get_field('first_content_block', $villa->ID);
									$add_foto = $villa_info["block_image"];
									if($add_foto) :
									?>
										<div class="img2">
											<?php echo wp_get_attachment_image($add_foto, 'medium'); ?>
										</div>
									<?php endif; ?>
								</div>
							</div>
						</div>
						<?php wp_reset_postdata(); ?>
					<?php endforeach; ?>
					
				</div>
				<div class="arrows">
					<div class="prev">
						<svg width="33" height="12" viewBox="0 0 33 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.4146 0.983607L6.431 0L0.434929 5.99607L6.43886 12L7.42247 11.0164L3.0946 6.68852H33V5.30361L3.0946 5.30361L7.4146 0.983607Z" fill="#1F5465"/></svg>
					</div>
					<div class="next">
						<svg width="33" height="12" viewBox="0 0 33 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M25.5854 0.983607L26.569 0L32.5651 5.99607L26.5611 12L25.5775 11.0164L29.9054 6.68852H0V5.30361L29.9054 5.30361L25.5854 0.983607Z" fill="#1F5465"/></svg>
					</div>
				</div>
			</div>
		</section>
	<?php endif; ?>
	

	
		<div class="testimonials">
			<div class="container">
				<div class="testimonials__top">
					<?php 
					
					$areas = get_terms(array(
						'taxonomy' => 'areas',
						'hide_empty' => false,
						//'parent' => 0,
						'object_ids' => $villas,
						'orderby' => 'name',
						'order' => 'ASC'
					));
					//print_r($areas);
					?>
					
					<?php if($areas) { ?>
					<div class="select">
							<select class="select_areas">
								<option value="">Select area</option>
								<option value="0">Show all</option>
								<?php foreach($areas as $area) { ?>
									<?php if($area->parent == 0) : ?>
										<option class="first_item" value="<?php echo $area->term_id; ?>">
											<?php echo $area->name; ?>
										</option>
									<?php else : ?>
										<?php $parent_term = get_term($area->parent, 'areas');	?>
											<optgroup label="<?php echo $parent_term->name; ?>">
		
												<option class="second_item" value="<?php echo $area->term_id; ?>">
													<?php echo $area->name; ?>
												</option>
											
										</optgroup>	
									<?php endif; ?>
								<?php } ?>									
							</select>
						</div>
					<?php } ?>
					

					<div class="desc">Latest Reviews</div>
					<div class="raiting">
						<div class="title">
							<?php echo $average_rating; ?>
							<svg width="107" height="16" viewBox="0 0 107 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.2357 5.36836C13.5902 5.36836 11.9447 5.38625 10.2993 5.40413C9.67327 3.72288 9.04727 2.02374 8.45704 0.324599C8.34973 0.00265624 7.81316 -0.158315 7.65218 0.217284C6.90099 1.9522 6.14979 3.68711 5.45224 5.45779C3.91408 5.49356 2.37591 5.52933 0.855622 5.5651C0.40848 5.58299 0.0865374 6.1911 0.462137 6.51304C0.998708 6.96019 1.51739 7.42521 2.03608 7.90813C2.48322 8.3195 2.91248 8.74876 3.34173 9.1959C3.5027 9.37475 3.73522 9.5715 3.86042 9.78613C4.02139 10.0723 3.84253 10.3227 3.73522 10.591C3.1271 12.1291 2.57265 13.7031 2.03608 15.277C1.87511 15.7242 2.46533 16.1892 2.85882 15.9209C4.03927 15.1339 5.23762 14.347 6.43596 13.5958C6.79367 13.3811 7.15139 13.1486 7.5091 12.934C7.84893 12.7373 7.90258 12.7909 8.22453 12.9877C8.49281 13.1486 8.7611 13.3275 9.0115 13.5063C10.1383 14.2933 11.1757 15.1697 12.3561 15.8851C12.7138 16.0998 13.1431 15.7421 13.0358 15.3665C12.7317 14.1681 12.4455 12.9877 12.1951 11.7714C12.0699 11.1633 11.8732 10.5016 11.8374 9.89344C11.8195 9.33898 12.3203 9.08858 12.6959 8.76664C13.6618 7.92601 14.6097 7.0675 15.5577 6.1911C15.8796 5.88705 15.6292 5.36836 15.2357 5.36836Z" fill="#26848B"/><path d="M37.9037 5.36836C36.2582 5.36836 34.6127 5.38625 32.9672 5.40413C32.3412 3.72288 31.7152 2.02374 31.125 0.324599C31.0177 0.00265624 30.4811 -0.158315 30.3202 0.217284C29.569 1.9522 28.8178 3.68711 28.1202 5.45779C26.582 5.49356 25.0439 5.52933 23.5236 5.5651C23.0764 5.58299 22.7545 6.1911 23.1301 6.51304C23.6667 6.96019 24.1854 7.42521 24.704 7.90813C25.1512 8.3195 25.5804 8.74876 26.0097 9.1959C26.1707 9.37475 26.4032 9.5715 26.5284 9.78613C26.6894 10.0723 26.5105 10.3227 26.4032 10.591C25.7951 12.1291 25.2406 13.7031 24.704 15.277C24.5431 15.7242 25.1333 16.1892 25.5268 15.9209C26.7072 15.1339 27.9056 14.347 29.1039 13.5958C29.4616 13.3811 29.8194 13.1486 30.1771 12.934C30.5169 12.7373 30.5706 12.7909 30.8925 12.9877C31.1608 13.1486 31.4291 13.3275 31.6795 13.5063C32.8063 14.2933 33.8436 15.1697 35.0241 15.8851C35.3818 16.0998 35.8111 15.7421 35.7037 15.3665C35.3997 14.1681 35.1135 12.9877 34.8631 11.7714C34.7379 11.1633 34.5412 10.5016 34.5054 9.89344C34.4875 9.33898 34.9883 9.08858 35.3639 8.76664C36.3297 7.92601 37.2777 7.0675 38.2256 6.1911C38.5476 5.88705 38.2972 5.36836 37.9037 5.36836Z" fill="#26848B"/><path d="M60.5677 5.36836C58.9223 5.36836 57.2768 5.38625 55.6313 5.40413C55.0053 3.72288 54.3793 2.02374 53.7891 0.324599C53.6818 0.00265624 53.1452 -0.158315 52.9842 0.217284C52.233 1.9522 51.4818 3.68711 50.7843 5.45779C49.2461 5.49356 47.7079 5.52933 46.1877 5.5651C45.7405 5.58299 45.4186 6.1911 45.7942 6.51304C46.3307 6.96019 46.8494 7.42521 47.3681 7.90813C47.8153 8.3195 48.2445 8.74876 48.6738 9.1959C48.8347 9.37475 49.0672 9.5715 49.1924 9.78613C49.3534 10.0723 49.1746 10.3227 49.0672 10.591C48.4591 12.1291 47.9047 13.7031 47.3681 15.277C47.2071 15.7242 47.7974 16.1892 48.1909 15.9209C49.3713 15.1339 50.5696 14.347 51.768 13.5958C52.1257 13.3811 52.4834 13.1486 52.8411 12.934C53.181 12.7373 53.2346 12.7909 53.5566 12.9877C53.8248 13.1486 54.0931 13.3275 54.3435 13.5063C55.4703 14.2933 56.5077 15.1697 57.6882 15.8851C58.0459 16.0998 58.4751 15.7421 58.3678 15.3665C58.0638 14.1681 57.7776 12.9877 57.5272 11.7714C57.402 11.1633 57.2052 10.5016 57.1695 9.89344C57.1516 9.33898 57.6524 9.08858 58.028 8.76664C58.9938 7.92601 59.9417 7.0675 60.8897 6.1911C61.2116 5.88705 60.9612 5.36836 60.5677 5.36836Z" fill="#26848B"/><path d="M83.2357 5.36836C81.5902 5.36836 79.9447 5.38625 78.2993 5.40413C77.6733 3.72288 77.0473 2.02374 76.457 0.324599C76.3497 0.00265624 75.8132 -0.158315 75.6522 0.217284C74.901 1.9522 74.1498 3.68711 73.4522 5.45779C71.9141 5.49356 70.3759 5.52933 68.8556 5.5651C68.4085 5.58299 68.0865 6.1911 68.4621 6.51304C68.9987 6.96019 69.5174 7.42521 70.0361 7.90813C70.4832 8.3195 70.9125 8.74876 71.3417 9.1959C71.5027 9.37475 71.7352 9.5715 71.8604 9.78613C72.0214 10.0723 71.8425 10.3227 71.7352 10.591C71.1271 12.1291 70.5726 13.7031 70.0361 15.277C69.8751 15.7242 70.4653 16.1892 70.8588 15.9209C72.0393 15.1339 73.2376 14.347 74.436 13.5958C74.7937 13.3811 75.1514 13.1486 75.5091 12.934C75.8489 12.7373 75.9026 12.7909 76.2245 12.9877C76.4928 13.1486 76.7611 13.3275 77.0115 13.5063C78.1383 14.2933 79.1757 15.1697 80.3561 15.8851C80.7138 16.0998 81.1431 15.7421 81.0358 15.3665C80.7317 14.1681 80.4455 12.9877 80.1951 11.7714C80.0699 11.1633 79.8732 10.5016 79.8374 9.89344C79.8195 9.33898 80.3203 9.08858 80.6959 8.76664C81.6618 7.92601 82.6097 7.0675 83.5577 6.1911C83.8796 5.88705 83.6292 5.36836 83.2357 5.36836Z" fill="#26848B"/><path d="M105.904 5.36836C104.258 5.36836 102.613 5.38625 100.967 5.40413C100.341 3.72288 99.7152 2.02374 99.125 0.324599C99.0177 0.00265624 98.4811 -0.158315 98.3202 0.217284C97.569 1.9522 96.8178 3.68711 96.1202 5.45779C94.582 5.49356 93.0439 5.52933 91.5236 5.5651C91.0764 5.58299 90.7545 6.1911 91.1301 6.51304C91.6667 6.96019 92.1854 7.42521 92.704 7.90813C93.1512 8.3195 93.5804 8.74876 94.0097 9.1959C94.1707 9.37475 94.4032 9.5715 94.5284 9.78613C94.6894 10.0723 94.5105 10.3227 94.4032 10.591C93.7951 12.1291 93.2406 13.7031 92.704 15.277C92.5431 15.7242 93.1333 16.1892 93.5268 15.9209C94.7072 15.1339 95.9056 14.347 97.1039 13.5958C97.4616 13.3811 97.8194 13.1486 98.1771 12.934C98.5169 12.7373 98.5706 12.7909 98.8925 12.9877C99.1608 13.1486 99.4291 13.3275 99.6795 13.5063C100.806 14.2933 101.844 15.1697 103.024 15.8851C103.382 16.0998 103.811 15.7421 103.704 15.3665C103.4 14.1681 103.114 12.9877 102.863 11.7714C102.738 11.1633 102.541 10.5016 102.505 9.89344C102.488 9.33898 102.988 9.08858 103.364 8.76664C104.33 7.92601 105.278 7.0675 106.226 6.1911C106.548 5.88705 106.297 5.36836 105.904 5.36836Z" fill="#26848B"/></svg>
						</div>
						<div class="desc">
							From 
							<?php 
							$c = floor(($testimonials_count / 10))*10;
							if($c == 0) $c = $testimonials_count;
							else $c = $c.'+';
							echo $c;
							?>
							Customer Reviews</div>
					</div>
				</div>

				<div class="testimonials__body">
					<div id="response">
						<?php 
						foreach($testimonials as $testimonial) {
							get_template_part('template-parts/post-lists/testimonial', '', array('testimonial' => $testimonial));
						}
						?>
					</div>
					
					<?php //if($testimonials_list->max_num_pages > 1) : ?>
						<!--div class="bottom">
							<a href="#" class="btn-1 load-more-testimonials">load more</a>
						</div-->
					<?php //endif; ?>
					
					<!--input type="hidden" name="page" id="page" value="<?php //echo $paged; ?>">
					<input type="hidden" name="per_page" id="per_page" value="<?php //echo get_option( 'posts_per_page' ); ?>">
					<input type="hidden" name="max-pages" id="max-pages" value="<?php //echo $testimonials_list->max_num_pages; ?>">
					<input type="hidden" name="area_tax" id="area_tax" value="">
					<input type="hidden" name="post_type" id="post_type" value="testimonial"-->
					
				</div>
			</div>
		</div>


	<?php get_template_part('template-parts/contact_us'); ?>
	
</main>

<?php get_footer(); ?>